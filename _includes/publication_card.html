{% assign bib_key = include.key %}
{% assign meta = include.meta %}
{% assign bib = site.data.publication_citations[bib_key] %}

{% assign card_title = meta.title %}
{% if bib and bib.title and bib.title != "" %}
  {% assign card_title = bib.title %}
{% endif %}
{% if card_title == nil or card_title == "" %}
  {% assign card_title = bib_key %}
{% endif %}

{% assign card_citation = meta.citation %}
{% if bib and bib.citation and bib.citation != "" %}
  {% assign card_citation = bib.citation %}
{% endif %}

{% assign primary_url = "" %}
{% assign arxiv_url = "" %}
{% if meta and meta.artifact_links %}
  {% for link in meta.artifact_links %}
    {% if primary_url == "" and link.url and link.url != "" %}
      {% assign primary_url = link.url %}
    {% endif %}
    {% assign label_lc = link.label | downcase %}
    {% assign url_lc = link.url | downcase %}
    {% if label_lc contains "arxiv" or url_lc contains "arxiv.org" %}
      {% assign arxiv_url = link.url %}
      {% break %}
    {% endif %}
  {% endfor %}
{% endif %}
{% if arxiv_url != "" %}
  {% assign primary_url = arxiv_url %}
{% endif %}

<article class="ri-pub-card">
  <header class="ri-pub-card-head">
    {% if primary_url != "" %}
      <h3><a class="ri-pub-title-link" href="{{ primary_url }}" rel="noopener noreferrer">{{ card_title }}</a></h3>
    {% else %}
      <h3>{{ card_title }}</h3>
    {% endif %}
  </header>

  {% if meta.award_badge and meta.award_badge != "" %}
    <p class="ri-pub-badge-row">
      <span class="ri-badge">{{ meta.award_badge }}</span>
    </p>
  {% endif %}

  {% if meta.tagline and meta.tagline != "" %}
    <p class="ri-pub-tagline">{{ meta.tagline }}</p>
  {% endif %}

  {% if card_citation and card_citation != "" %}
    <p class="ri-pub-citation">{{ card_citation }}</p>
  {% endif %}

  {% if meta and meta.artifact_links and meta.artifact_links.size > 0 %}
    <p class="ri-pub-links">
      {% for link in meta.artifact_links %}
        {% if link.url and link.url != "" %}
          <a href="{{ link.url }}" rel="noopener noreferrer">{{ link.label }}</a>
          {% unless forloop.last %}<span aria-hidden="true">Â·</span>{% endunless %}
        {% endif %}
      {% endfor %}
    </p>
  {% endif %}

  {% if meta.summary and meta.summary != "" %}
    <p class="ri-pub-summary">{{ meta.summary }}</p>
  {% endif %}
</article>
