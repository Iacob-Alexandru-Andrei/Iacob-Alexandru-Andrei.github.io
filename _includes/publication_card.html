{% assign bib_key = include.key %}
{% assign meta = include.meta %}
{% assign bib = site.data.publication_citations[bib_key] %}

{% assign card_title = meta.title %}
{% if bib and bib.title and bib.title != "" %}
  {% assign card_title = bib.title %}
{% endif %}
{% if card_title == nil or card_title == "" %}
  {% assign card_title = bib_key %}
{% endif %}

{% assign card_citation = meta.citation %}
{% if bib and bib.citation and bib.citation != "" %}
  {% assign card_citation = bib.citation %}
{% endif %}

{% assign arxiv_url = "" %}
{% if meta and meta.artifact_links %}
  {% for link in meta.artifact_links %}
    {% assign label_lc = link.label | downcase %}
    {% assign url_lc = link.url | downcase %}
    {% if label_lc contains "arxiv" or url_lc contains "arxiv.org" %}
      {% assign arxiv_url = link.url %}
      {% break %}
    {% endif %}
  {% endfor %}
{% endif %}

{% assign card_class = "ri-pub-card" %}
{% if arxiv_url != "" %}
  {% assign card_class = "ri-pub-card ri-pub-card--linked" %}
{% endif %}

{% if arxiv_url != "" %}
<a class="{{ card_class }}" href="{{ arxiv_url }}" rel="noopener noreferrer">
{% else %}
<article class="{{ card_class }}">
{% endif %}
  <header class="ri-pub-card-head">
    <h3>{{ card_title }}</h3>
  </header>

  {% if meta.award_badge and meta.award_badge != "" %}
    <p class="ri-pub-badge-row">
      <span class="ri-badge">{{ meta.award_badge }}</span>
    </p>
  {% endif %}

  {% if meta.tagline and meta.tagline != "" %}
    <p class="ri-pub-tagline">{{ meta.tagline }}</p>
  {% endif %}

  {% if card_citation and card_citation != "" %}
    <p class="ri-pub-citation">{{ card_citation }}</p>
  {% endif %}

  {% if meta.summary and meta.summary != "" %}
    <p class="ri-pub-summary">{{ meta.summary }}</p>
  {% endif %}

{% if arxiv_url != "" %}
</a>
{% else %}
</article>
{% endif %}
